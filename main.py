Pierro
#6279
üíªSegmentation Fault

Pierro ‚Äî 23/12/2022 16:22
et si tu peux tt relire pour v√©rifier que j'ai pas fait de fautes c'est top
Raisahmed ‚Äî 23/12/2022 16:42
ok √ßa marche je relirais et j'ajouterais ce que tu m'as dis d'ajouter concernant mon graphe
Pierro ‚Äî 23/12/2022 16:43
Ok tu g√®res tes ne boss
Raisahmed ‚Äî 24/12/2022 12:02
Normalement j'ai push essaye de voir si tu peux r√©cup√©rer ce que j'ai fait
Pierro ‚Äî 24/12/2022 13:29
ouais c'est clean
je pense que le seul truc qu'on pourrait changer c'est sur le graph des temps moyen dans le tooltip changer l'affichage de l'heure
genre passer de 1.6-1.69h √† 1h40-1h49
fin je sais pas si c'est ca le bon calcul
mais c'est une id√©e que j'ai eu
Raisahmed ‚Äî 24/12/2022 14:20
Ouais en vrai on pourrait faire √ßa apr√®s c'est un peu compliqu√© parce que du coup les trucs √† 1.70h faut les convertir et jsp trop comment on s'y prend
Pierro ‚Äî 24/12/2022 15:24
Ouais bv
Je pense qu'on a fini mais je vais voir si jamais on a pas de nouvelle id√©e
Raisahmed ‚Äî 24/12/2022 21:56
D√©sol√© de te r√©pondre que maintenant mais ouais en vrai si t‚Äôas des id√©es de trucs √† rajouter vas y moi pour l‚Äôinstant je pense c‚Äôest ok
Pierro ‚Äî 25/12/2022 00:06
tkt tkt y a le temps bg 
Pierro ‚Äî Hier √† 11:56
ouais bg
on avait pas vu mais y a encore un truc a faire :
https://perso.esiee.fr/~courivad/3IPR2/miniprojetdata.html#miniprojet:~:text=travail%20sera%20%C3%A9valu%C3%A9.-,Remise%20du%20travail,-%C2%B6
faut √©crire le readme.md avec plusieurs sections
j'ai pas mal commenc√© mais chaud que tu avances dessus aussi
j'ai tout push
Raisahmed ‚Äî Hier √† 11:59
j'ai lu vite fait ce qu'il devait y avoir dans le readme maintenant je comprends toi y'a quoi comme trucs que t'as mis dedans que je sache ce qu'il me reste √† faire ?
Pierro ‚Äî Hier √† 12:00
Le Developper Guide j'ai pas tour fait
Et le reste faudrait que tu corrige / ajoute des trucs si tu vois des trucs qui manque
Raisahmed ‚Äî Hier √† 12:03
Ok bah vas y pas de soucis je fini le Developper Guide c'est le truc que j'ai le mieux compris et je regarderais pour le reste je te dis si √ßa peut √™tre am√©lior√© !
Pierro ‚Äî Hier √† 12:14
Ouais parfait 
Et apr√®s regarde sur le site en g√©n√©rale si on a bien tout fait
Raisahmed ‚Äî Hier √† 12:14
ouais c'est s√ªr faut √™tre sur qu'on a tout bien fait et qu'il y ai pas un truc bizarre
Pierro ‚Äî Hier √† 12:19
Ye
Prcq y a plein de ptit truc en plus a faire
Raisahmed ‚Äî Hier √† 12:19
comme quoi ?
Pierro ‚Äî Hier √† 12:20
Le readme et apres pour le fichiers √† joindre et le git je crois que c'est bon
Raisahmed ‚Äî Hier √† 12:20
ah donc faut juste faire le readme ?
Pierro ‚Äî Hier √† 12:20
Je crois
Check le reste
Raisahmed ‚Äî Hier √† 12:27
bah je viens de tout lire il me semble que c'est bon il faut juste que moi je rajoute des commentaires sur mes parties de codes pour expliquer tout √ßa et faire le readme sinon c'est bon
Pierro ‚Äî Hier √† 12:27
Ok parfait !
Pierro ‚Äî Hier √† 16:24
okay bg tu me diras quand t'auras ajouter ta parti comme √ßa je relirai tout (√ßa presse pas tkt)
faut juste qu'on fini demain pour avoir un jour de rab au cas ou
Raisahmed ‚Äî Hier √† 16:26
Ok bah je fini le taff √† 17h le temps que je rentre chez moi et que je me mette bien il sera surement 19h donc ce soir j'essaye de faire tout √ßa si je suis pas trop k.o mais si je suis k.o je te pr√©viendrais avant mais t'as raison c'est mieux de faire √ßa ce soir pour laiss√© un jour en plus on sait jamais
c'est pour quand max le d√©p√¥t ?
c'est samedi le max ?
Pierro ‚Äî Hier √† 16:41
ahhh ouais tu taff
le rendu c'est le samedi 31
dc on fini ce soir / demain et on vise de rendre demain soir comme ca si besoin on a samedi en rab
Raisahmed ‚Äî Hier √† 16:42
ok ok √ßa marche je vais essayer ce soir de finir t'fa√ßon normalement √ßa va pas √™tre long le readme et les commentaires donc vas y on fait comme √ßa 
Pierro ‚Äî Hier √† 16:43
ouais c'est rapide de fou
Raisahmed ‚Äî Hier √† 20:45
Je viens de me poser devant le pc je sais pas si j'aurais le temps de finir ce soir parce que je dois me coucher t√¥t du coup mais je vais essayer d'avancer du mieux que je peux
Raisahmed ‚Äî Hier √† 22:54
 
#imports g√©n√©raux
import dash
from dash import Dash, dcc, html, Input, Output
import numpy as np
import plotly.express as px
import pandas as pd
Afficher plus
main.py
17 Ko
d√©sol√© mec je te met les trucs que j'ai modifi√© ici parce que j'arrive pas √† push
je sais pas pourquoi
j'ai modifi√© quelques trucs sur le main nottament des commentaires
et sur le README j'ai fini le developpeur guice 
# Python dashboard

Autheurs : Pierre ALLA - Ahmed RAIS

Classe : E3 FI groupe 3

Afficher plus
README.md
8 Ko
Pierro ‚Äî Aujourd‚Äôhui √† 10:38
ok parfait
je m'ccupe de rajouter tes trucs
Ôªø
#imports g√©n√©raux
import dash
from dash import Dash, dcc, html, Input, Output
import numpy as np
import plotly.express as px
import pandas as pd
import random

#import de notre fichier map_gares.py qui nous permets de cr√©er la map et nous retourne la liste des gares les plus fr√©quent√©es
import map_gares

#on cr√©e notre app et on lui donne un titre
app = Dash(__name__)
app.title = "SNCF - Dashboard"

#on cr√©e un dictionnaire qui nous permettra de renommer les colonnes de notre dataframe
nouveaux_noms = {
    'Date'                                                                                          : 'Date',
    'Service'                                                                                       : 'Service',
    'Gare de d√©part'                                                                                : 'Gare_de_depart',
    'Gare d\'arriv√©e'                                                                               : 'Gare_d_arrivee',
    'Dur√©e moyenne du trajet'                                                                       : 'Duree_moyenne_du_trajet',
    'Nombre de circulations pr√©vues'                                                                : 'Nombre_de_circulations_prevues',
    'Nombre de trains annul√©s'                                                                      : 'Nombre_de_trains_annules',
    'Commentaire annulations'                                                                       : 'Commentaire_annulations',
    'Nombre de trains en retard au d√©part'                                                          : 'Nombre_de_trains_en_retard_au_depart',
    'Retard moyen des trains en retard au d√©part'                                                   : 'Retard_moyen_des_trains_en_retard_au_depart',
    'Retard moyen de tous les trains au d√©part'                                                     : 'Retard_moyen_de_tous_les_trains_au_depart',
    'Commentaire retards au d√©part'                                                                 : 'Commentaire_retards_au_depart',
    'Nombre de trains en retard √† l\'arriv√©e'                                                       : 'Nombre_de_trains_en_retard_√†_l_arrivee',
    'Retard moyen des trains en retard √†  l\'arriv√©e'                                               : 'Retard_moyen_des_trains_en_retard_√†_l_arrivee',
    'Retard moyen de tous les trains √†  l\'arriv√©e'                                                 : 'Retard_moyen_de_tous_les_trains_√†_l_arrivee',
    'Commentaire retards √†  l\'arriv√©e'                                                             : 'Commentaire_retards_√†_l_arrivee',
    'Nombre trains en retard > 15min'                                                               : 'Nombre_trains_en_retard',
    'Retard moyen trains en retard > 15 (si liaison concurrenc√©e par vol)'                          : 'Retard_moyen_trains_en_retard_>_15_si_liaison_concurrencee_par_vol',
    'Nombre trains en retard > 30min'                                                               : 'Nombre_trains_en_retard_>_30min',
    'Nombre trains en retard > 60min'                                                               : 'Nombre_trains_en_retard_>_60min',
    'Prct retard pour causes externes'                                                              : 'Prct_retard_pour_causes_externes',
    'Prct retard pour cause infrastructure'                                                         : 'Prct_retard_pour_cause_infrastructure',
    'Prct retard pour cause gestion trafic'                                                         : 'Prct_retard_pour_cause_gestion_trafic',
    'Prct retard pour cause mat√©riel roulant'                                                       : 'Prct_retard_pour_cause_materiel_roulant',
    'Prct retard pour cause gestion en gare et r√©utilisation de mat√©riel'                           : 'Prct_retard_pour_cause_gestion_en_gare_et_reutilisation_de_materiel',
    'Prct retard pour cause prise en compte voyageurs (affluence, gestions PSH, correspondances)'   : 'Prct_retard_pour_cause_prise_en_compte_voyageurs_affluence,_gestions_PSH,_correspondances'
}

# Le code ci-dessus cr√©e un dictionnaire appel√© colors. Le dictionnaire a trois cl√©s : 
# background, texte, et axe. Chaque cl√© a une valeur qui est une cha√Æne de caract√®res.
colors = {
    'background': '#C4F5FC',
    'text': '#000000',
    'axis' : '#000000'
}

# on lit notre fichier csv et on renome les colonnes gr√¢ce √† notre dictionnaire
data = pd.read_csv('data.csv', sep=';', header=0)
data.rename(columns=nouveaux_noms, inplace=True)

########### MAP + DATA PREMIER GRAPH GRAPH ###########
# on g√©nere la map et on r√©cup√®re la liste des gare les plus fr√©quent√©es
index_gares = map_gares.create_map()

########### PREMIER GRAPH ###########

# traitement des donn√©es concernant les gares les plus fr√©quent√©es
list_index_gares = index_gares.tolist()
for param in list_index_gares:
    gare = data.query(f'Gare_de_depart == "{param}"')
    gare_moy = gare.groupby('Gare_de_depart', as_index=False)[["Duree_moyenne_du_trajet"]].mean()
compteur = data['Gare_de_depart'].value_counts()
compteur2 = compteur.where(compteur > 100)
compteur2 = compteur2.dropna()

# cr√©ation du graphique
figure = px.bar(y = compteur2, x = compteur2.index, barmode="group")    

# mise en forme du graphique
figure.update_layout(
    plot_bgcolor=colors['background'],
    paper_bgcolor=colors['background'],
    font_color=colors['text'],
    xaxis_title='Noms des gares',
    yaxis_title='Nombre de trajets',
    title="Nombre de trajets par gare de d√©part pour les gares ayant plus de 100 trajets au d√©part",
    xaxis = dict(linecolor=colors['axis']),
    yaxis = dict(linecolor=colors['axis']),
)

# ajout de bordure noir autour du graphique
figure.update_traces(marker_line_color='black', marker_line_width=1)

# ajout d'une couleur al√©atoire a chaque barre
random_colors = [random.choice(['red', 'orange', 'yellow', 'green', 'blue', 'indigo', 'violet']) for i in range(len(data))]
figure.update_traces(marker_color=random_colors)

########### DEUXIEME GRAPH ###########

# traitement des donn√©es concernant le temps de trajet moyen par gare
data['tps_arrondi'] = data['Duree_moyenne_du_trajet'].apply(lambda x: x/60)
tps_arrondi = data['tps_arrondi'].value_counts()

# cr√©ation du graphique
fig = px.histogram(data, x="tps_arrondi", labels={"tps_arrondi":"Temps de trajet (en heures)", "y" : "Nombre de trajets"})

# mise en forme du graphique
fig.update_layout(
    plot_bgcolor=colors['background'],
    paper_bgcolor=colors['background'],
    font_color=colors['text'],
    xaxis_title='Temps en heures',
    yaxis_title='Nombre de trajets',
    title="Temps de trajet arrondi √† l'heure",
    xaxis = dict(linecolor=colors['axis']),
    yaxis = dict(linecolor=colors['axis'])
)

# ajout de bordure noire au graphe
fig.update_traces(marker_line_color='black', marker_line_width=2)

######################################
########### STRUCTURE HTML ###########

app.layout = html.Div(
    style={'backgroundColor': colors['background']},
    children=[
    html.H1(
        children='Python Dashboard',
        style={
            'textAlign': 'center',
        }
    ),

    html.Div(children='Traitement d\'un data set sur les trains', 
    style={
        'textAlign': 'center',
        'color': colors['text'],
        'backgroundColor': colors['background'],
        'margin-bottom': '35px'
    }),

    ########### PRESENTATION DATASET ###########

    html.Hr(),

    html.Div(
        children=[
            "Ce dashboard est r√©alis√© √† partir de deux data set de la SNCF sur les trains en France de janvier 2018 √† fin 2022. (date de t√©l√©chargement du dataset)",
            html.Br(),
            html.Br(),
            " Le fichier CSV contient des informations sur la r√©gularit√© des trains TGV sur une p√©riode donn√©e,"
            " chaque ligne repr√©sentant les donn√©es de r√©gularit√© pour un mois donn√©.",
            html.Br(),
            "Le fichier GeoJSON en question contient une liste de gares en France, avec des informations sur leur"
            " nom, leur localisation g√©ographique (latitude et longitude), leur code de gare, leur type de gare"
            " (par exemple, TGV, TER, RER, etc.) ainsi que d'autres d√©tails. Chaque gare est repr√©sent√©e sous la forme d'un"
            " objet JSON avec ces diff√©rentes propri√©t√©s.",
            html.Br(),
            html.Br(),
            " Ce data set contient les informations suivantes :",
            html.Br(),
            "Gare de d√©part - Gare d'arriv√©e - Dur√©e moyenne du trajet - Nombre de trains au d√©part - Nombre de trains √† l'arriv√©e"
            " - Nombre de trains annul√©s - Nombre",
            html.Br(),
            html.Br(),
            "Il contient d'autres colonnes avec des pourcentages en fonction de certaines donn√©es, comme par exemple la r√©gularit√© des trains,"
            " ce qui d√©signe" 
            " le pourcentage de trains qui arrivent √† l'heure √† leur destination finale. Cette donn√©e est calcul√©e en comparant le nombre"
            " de trains arriv√©s √† l'heure √† leur destination finale au nombre total de trains pr√©vus pour cette ligne.",
            html.Br(),
            html.Br(),
            html.Br(),
            html.B(
            "Il est important de comprendre que dans le dataset les donn√©es sont pr√©sent√©es par liaisons. Une liaison est un trajet entre deux"
            " gares. Par exemple, la liaison Paris Gare de Lyon - Lyon Part-Dieu est un trajet entre la gare de Paris Gare de Lyon et la gare de Lyon Part-Dieu."
            " Ainsi, le dataset contient des informations sur les trajets entre toutes les gares de France, Mais aussi certaines gare √©trang√®res"
            " comme Madrid par exemple."
            ),
            html.Br(),
            html.Br(),
            html.B(
            "Le fait que les donn√©es soit par rapport aux liaisions et non √† chaque trajet est important car cela signifie que"
            " un trajet entre Paris Gare de Lyon et Marseille Saint-Charles est compt√© une seule fois par mois, alors que si on"
            " comptait les trajets individuels, il y aurait beaucoup plus de trajets redondants."
            )
        ],
        style={
            'textAlign': 'left',
            'color': colors['text'],
            'display': 'block',
            'margin-bottom': '20px'
        }
    ),

    html.Hr(),

    ########### PREMIER GRAPH ###########

    html.Div(
        children=[
            "Ce graphique repr√©sente le nombre de trajets par gare de d√©part pour les gares ayant plus de 100 trajets au d√©part.",
            html.Br(),
            "Cliquez sur une barre pour afficher les informations de la gare : Ville - Nombre de train au d√©part",
            html.Br(),
            "On remarque que la gare de Paris Gare de Lyon est la gare la plus importante avec plus de 1474 trajets au d√©part.",
            html.Br()
            ],
        style={
            'textAlign': 'left', 
            'color': colors['text'], 
            'display': 'block',
            'margin-bottom': '20px',
            'margin-top': '50px',
        }
    ),

    dcc.Graph(
        id='graph-test',
        figure=figure
    ),

    html.Div(
        style={
            'height': '80px'
            }
        ),

    ########### MAP ###########

    html.Div(
        children=[
            "Cette carte ci dessous place les gares les plus importantes sur une carte de France.",
            html.Br(),
            "Une gare est consid√©r√©e comme importante si elle a plus de 100 trajets au d√©part. (cf graphique ci dessus)",
            html.Br(),
            "Cliquez sur une gare pour afficher ses inoformations : Ville - libell√© de la gare",
            html.Br()
            ],
        style={
            'textAlign': 'center', 
            'color': colors['text'], 
            'display': 'block',
            'margin-bottom': '20px'
        }
    ),

    html.Div(
        children=[
        html.Iframe(
                id='map',
                srcDoc=open('gare.html', 'r').read(),
                width='50%',
                height='600'
            )
        ],
        className='row',
        style={
            'display': 'flex', 
            'justify-content': 'center', 
            'color': colors['text'],
            'backgroundColor': colors['background'],
            'margin-bottom': '30px'
        }
    ),

    ########### DEUXIEME GRAPH ###########

    dcc.Graph(
        id='example-graph',
        figure=fig
    ),

    html.Div(
        children=[
            "Le graphe ci dessus rep√©sente le temps de trajet arrondi √† l'heure pour l'ensemble des trajets pr√©sent dans le dataset : \"data.csv\"",
            html.Br(),
            "On peut voir que la majorit√© des trajets durent entre 1h et 4h et m√™me plus pr√©cis√©ment entre 1h et 2h.",
            ],
        style={
            'textAlign': 'center', 
            'color': colors['text'], 
            'display': 'block',
            'backgroundColor': colors['background'],
            'margin-bottom': '20px'
            }
    ),

    ########### TROISIEME GRAPH ###########

    html.Div(
        children=[
            "Le graphe ci dessous repr√©sente le pourcentage de trains en retard par nombre de trains pour chaque gare",
            html.Br(),
            "On peut voir que certaines gares ont plus de retard que d'autres, le calcul du pourcentage de retard se fait en fonction du nombre de trains",
            html.Br(),
            "Donc par exemple si une gare n'a que 3 trains qui partent, et que les 3 trains partent en retard alors son pourcentage de trains en retard sera de 100%",
            ],
        style={
            'textAlign': 'center', 
            'color': colors['text'], 
            'display': 'block',
            'backgroundColor': colors['background'],
            'margin-top': '60px'
            }
    ),

    dcc.Graph(
        id='example-graph3'
    ),
    html.P("R√©glage du pourcentage maximum de retards :"),
    dcc.Slider(
        id="mean", 
        min=0, 
        max=100, 
        value=100, 
        marks={0: '0', 100: '100'},
        tooltip={"placement": "bottom", "always_visible": True}
    ),


########### BAS DE PAGE ###########

    html.Footer(
    children=[
        html.Div(
            children=[
                "Projet r√©alis√© par : Pierre ALLA et Ahmed Rais - Date : 2021 - Mati√®re : Python"
                ],
                style={
                    'textAlign': 'center',
                    'color': colors['text'],
                    'backgroundColor': colors['background'],
                    'margin-top': '20px',
                    'margin-bottom': '5px'
                }
            )
        ]
    )
])

#######################################
########### TROISIEME GRAPH TRAITEMENT ###########

@app.callback(
    Output("example-graph3", "figure"), 
    Input("mean", "value"))

def display_color(mean):
    # traitement des donn√©es selon le nombre de trains en retard par rapport au retard moyen des trains et calcul de la moyenne
    circulation = data.groupby("Gare_de_depart", as_index=False)[["Nombre_de_trains_en_retard_au_depart", "Retard_moyen_des_trains_en_retard_au_depart"]].sum()
    circulation["moyenne"] = circulation.apply(lambda x: (x.Retard_moyen_des_trains_en_retard_au_depart / x.Nombre_de_trains_en_retard_au_depart)*100, axis = 1)
    circulation = circulation[ circulation["moyenne"] < mean ]

    # on cr√©er l'histogramme
    fig3 = px.histogram(circulation, x="moyenne", y = "Gare_de_depart", color="Gare_de_depart", range_x=[0,mean])
    
    # mise en forme du graphique
    fig3.update_layout(
        plot_bgcolor=colors['background'],
        paper_bgcolor=colors['background'],
        font_color=colors['text'],
        xaxis_title='Pourcentage de trains en retard',
        yaxis_title='Gares',
        title="Pourcentage de trains en retard par nombre de trains",
        xaxis = dict(linecolor=colors['axis']),
        yaxis = dict(linecolor=colors['axis'])
    )
    
    return fig3 

if __name__ == '__main__':
    #En passant le param√®tre √† True ou false cela permet entre autre d'afficher ou non le boutton bleu du mode
    # de debug de Dash
    # app.run_server(debug=True)
    app.run_server(debug=False)